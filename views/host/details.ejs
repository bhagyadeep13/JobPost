<%- include('../partials/head') %>
</head>
<body class="bg-gradient-to-br from-blue-50 via-cyan-50 to-teal-50 min-h-screen font-sans">
  <%- include('../partials/nav') %>

  <main class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Hero Section -->
    <div class="text-center mb-8">
      <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-cyan-500 to-teal-600 rounded-full shadow-lg mb-4">
        <svg class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
        </svg>
      </div>
      <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-600 via-blue-600 to-teal-600 mb-3 tracking-tight">
        <%= editing ? "Edit Job Posting" : "Post a New Job" %>
      </h1>
      <p class="text-lg text-gray-600">
        <%= editing ? "Update job details and requirements" : "Find the perfect candidate for your team" %>
      </p>
    </div>

    <!-- Form Card -->
    <div class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-2xl border-2 border-white/20 p-8 md:p-10">
      <form action="/host/<%= editing ? "edit-post" : "add-post"%>" method="POST" enctype="multipart/form-data" class="space-y-6">
        <input type="hidden" name="id" value="<%= editing ? job._id : ''%>">

        <!-- Job Title -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
            <svg class="w-5 h-5 text-cyan-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            Job Title *
          </label>
          <input 
            type="text" 
            value="<%= editing ? job.jobTitle : ''%>" 
            placeholder="e.g., Senior Software Engineer, Marketing Manager..." 
            name="jobTitle" 
            required 
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-white focus:outline-none focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 transition-all duration-300 text-lg font-medium"
          >
        </div>

        <!-- Company Name -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
            <svg class="w-5 h-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
            </svg>
            Company Name *
          </label>
          <input 
            type="text" 
            value="<%= editing ? job.companyName : ''%>" 
            placeholder="Enter your company name" 
            name="companyName" 
            required 
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-white focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300"
          >
        </div>

        <!-- Location & Salary Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Location -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
              <svg class="w-5 h-5 text-teal-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              Location *
            </label>
            <input 
              type="text" 
              value="<%= editing ? job.location : ''%>" 
              placeholder="e.g., New York, Remote, Hybrid" 
              name="location" 
              required 
              class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-white focus:outline-none focus:border-teal-500 focus:ring-2 focus:ring-teal-200 transition-all duration-300"
            >
          </div>

          <!-- Salary -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
              <svg class="w-5 h-5 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              Salary (Optional)
            </label>
            <input 
              type="text" 
              value="<%= editing ? job.salary : ''%>" 
              placeholder="e.g., $80,000 - $120,000/year" 
              name="salary" 
              class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-white focus:outline-none focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 transition-all duration-300"
            >
          </div>
        </div>

        <!-- Created At -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
            <svg class="w-5 h-5 text-cyan-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            Posting Date *
          </label>
          <input 
            type="date" 
            value="<%= editing && job.createdAt ? job.createdAt.toISOString().slice(0,10) : '' %>" 
            name="createdAt" 
            required 
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-white focus:outline-none focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 transition-all duration-300"
          >
        </div>

        <!-- Company Logo / Image Upload -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
            <svg class="w-5 h-5 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            Company Logo / Featured Image <%= editing ? "" : "*" %>
          </label>
          <div class="relative">
            <input
              type="file"
              name="photo"
              accept="image/*"
              <%= editing ? "" : "required" %>
              class="w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-xl bg-gray-50 hover:bg-gray-100 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-300 cursor-pointer file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-gradient-to-r file:from-cyan-500 file:to-teal-600 file:text-white hover:file:from-cyan-600 hover:file:to-teal-700 file:cursor-pointer"
            />
          </div>
          <p class="text-xs text-gray-500 mt-2">Upload company logo or job-related image. Recommended: 1200x600px, JPG or PNG, max 5MB</p>
        </div>

        <!-- Job Description -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
            <svg class="w-5 h-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            Job Description *
          </label>
          <textarea 
            name="jobDescription" 
            placeholder="Describe the role, responsibilities, requirements, and benefits...

Example:
â€¢ Key responsibilities and daily tasks
â€¢ Required skills and qualifications
â€¢ Preferred experience level
â€¢ Team structure and work environment
â€¢ Benefits and perks" 
            required 
            rows="10" 
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-white focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300 resize-none"
          ><%= editing ? job.jobDescription : '' %></textarea>
          <div class="flex items-center justify-between mt-2">
            <p class="text-xs text-gray-500">Include all relevant details about the position</p>
            <p class="text-xs text-gray-400" id="charCount">0 characters</p>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 pt-4">
          <button 
            type="submit" 
            class="flex-1 bg-gradient-to-r from-cyan-500 to-teal-600 hover:from-cyan-600 hover:to-teal-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 flex items-center justify-center gap-2"
          >
            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <span><%= editing ? "Update Job" : "Post Job" %></span>
          </button>
          <a 
            href="<%= editing ? '/host/host-posts' : '/' %>" 
            class="sm:w-auto px-8 bg-gray-100 hover:bg-gray-200 text-gray-700 py-4 rounded-xl font-semibold text-lg transition-all duration-300 flex items-center justify-center gap-2 border-2 border-gray-200"
          >
            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
            <span>Cancel</span>
          </a>
        </div>

        <!-- Helper Text -->
        <div class="bg-cyan-50 border-2 border-cyan-200 rounded-xl p-4 flex items-start gap-3 mt-6">
          <svg class="w-5 h-5 text-cyan-600 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div class="text-sm text-cyan-700">
            <p class="font-semibold mb-1">ðŸ’¡ Pro Tips for Job Postings:</p>
            <ul class="list-disc list-inside space-y-1 text-cyan-600">
              <li>Write a clear, specific job title that candidates will search for</li>
              <li>Include salary range to attract serious applicants</li>
              <li>List required vs. preferred qualifications separately</li>
              <li>Mention remote/hybrid options and benefits clearly</li>
              <li>Keep the description concise but comprehensive</li>
            </ul>
          </div>
        </div>

        <!-- Preview Section -->
        <div class="bg-gradient-to-r from-blue-50 via-cyan-50 to-teal-50 border-2 border-blue-100 rounded-xl p-6 mt-6">
          <div class="flex items-center gap-3 mb-3">
            <svg class="w-6 h-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            </svg>
            <h3 class="text-lg font-bold text-gray-900">Preview Your Posting</h3>
          </div>
          <p class="text-sm text-gray-600">
            Make sure all information is accurate before posting. Your job listing will be visible to all candidates immediately after submission.
          </p>
        </div>
      </form>
    </div>
  </main>

  <script>
    // Character counter for job description
    const textarea = document.querySelector('textarea[name="jobDescription"]');
    const charCount = document.getElementById('charCount');
    
    if (textarea && charCount) {
      const updateCount = () => {
        charCount.textContent = `${textarea.value.length} characters`;
      };
      
      textarea.addEventListener('input', updateCount);
      updateCount(); // Initial count
    }

    // Form validation enhancement
    const form = document.querySelector('form');
    form?.addEventListener('submit', (e) => {
      const jobTitle = form.querySelector('input[name="jobTitle"]').value.trim();
      const companyName = form.querySelector('input[name="companyName"]').value.trim();
      const location = form.querySelector('input[name="location"]').value.trim();
      const jobDescription = form.querySelector('textarea[name="jobDescription"]').value.trim();
      
      if (jobTitle.length < 3) {
        e.preventDefault();
        alert('Job title must be at least 3 characters long');
        return;
      }
      
      if (companyName.length < 2) {
        e.preventDefault();
        alert('Company name must be at least 2 characters long');
        return;
      }

      if (location.length < 2) {
        e.preventDefault();
        alert('Location must be at least 2 characters long');
        return;
      }
      
      if (jobDescription.length < 100) {
        e.preventDefault();
        alert('Job description must be at least 100 characters long to provide adequate information');
        return;
      }
    });

    // Auto-save draft functionality (optional)
    let autoSaveTimer;
    form?.addEventListener('input', () => {
      clearTimeout(autoSaveTimer);
      autoSaveTimer = setTimeout(() => {
        // Save draft to localStorage
        const formData = {
          jobTitle: form.querySelector('input[name="jobTitle"]').value,
          companyName: form.querySelector('input[name="companyName"]').value,
          location: form.querySelector('input[name="location"]').value,
          salary: form.querySelector('input[name="salary"]').value,
          jobDescription: form.querySelector('textarea[name="jobDescription"]').value
        };
        localStorage.setItem('jobDraft', JSON.stringify(formData));
      }, 2000);
    });

    // Load draft on page load
    window.addEventListener('load', () => {
      const draft = localStorage.getItem('jobDraft');
      if (draft && !<%= editing %>) {
        const formData = JSON.parse(draft);
        if (confirm('Would you like to restore your previous draft?')) {
          Object.keys(formData).forEach(key => {
            const element = form.querySelector(`[name="${key}"]`);
            if (element) element.value = formData[key];
          });
          // Update character count
          if (textarea && charCount) {
            charCount.textContent = `${textarea.value.length} characters`;
          }
        }
      }
    });

    // Clear draft on successful submission
    form?.addEventListener('submit', () => {
      localStorage.removeItem('jobDraft');
    });
  </script>
</body>
</html>